{% extends 'base.html' %}
{% load static %}

{% block title %}Asignar Materia{% endblock %}

{% block content %}


<div class="container mt-4">
  <h2 class="text-center mb-4">Gestión de Carga Académica</h2>

    <div class="d-flex flex-column gap-4">
      
      <div class="p-3 shadow rounded bg-light">
        <h4 class="mb-3">Docente: <span class="text-primary">{{ docente.nombre }} {{ docente.ape_paterno }}</span></h4>
        <div class="row">
          <div class="col-md-8">
            <table class="table table-bordered">
              <tbody>
                <tr>
                  <th>Nombre del Docente</th>
                  <td>{{ docente.nombre }} {{ docente.ape_paterno }} {{ docente.ape_materno|default:"" }}</td>
                </tr>
                <tr>
                  <th>Especialidad / Área</th>
                  <td>{{ docente.especialidad|default:"General" }}</td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="col-md-4 d-flex align-items-center">
          </div>
        </div>
      </div>

      <div class="p-3 shadow rounded bg-light">
        <h4 class="mb-3 text-success">Materias Disponibles / Vacantes</h4>
        <div class="table-responsive">
            <table class="table table-striped table-bordered align-middle">
              <thead class="bg-blue-600">
                <tr>
                  <th>Grupo</th>
                  <th>Materia</th>
                  <th>Profesor Actual</th>
                  <th>Horario</th>
                  <th>Acción</th>
                </tr>
              </thead>
              <tbody>
                {% for grupo in materias_disponibles %}
                <tr>
                  <td><strong>{{ grupo.clave_grupo }}</strong></td>
                  <td>{{ grupo.materia.nombre }}</td>
                  <td>
                    {% if grupo.docente %}
                        {{ grupo.docente.nombre }} {{ grupo.docente.ape_paterno }}
                    {% else %}
                        <span class="badge bg-warning text-dark">VACANTE</span>
                    {% endif %}
                  </td>
                  <td>
                      <small>
                      {% for h in grupo.horario_set.all %}
                        {{ h.get_dia_semana_display|slice:":3" }}: {{ h.hora_inicio|date:"H:i" }}<br>
                      {% empty %}Sin horario{% endfor %}
                      </small>
                  </td>
                  <td class="text-center">
                    <form method="POST">
                        {% csrf_token %}
                        <input type="hidden" name="grupo_id" value="{{ grupo.id_grupo }}">
                        <input type="hidden" name="accion" value="asignar">
                        <button type="submit" class="inline-flex items-center px-5 py-2.5 bg-blue-600 text-white text-sm font-medium rounded-lg hover:bg-blue-500 shadow-sm hover:shadow-md transition-all duration-200" >
                           Asignar
                        </button>
                    </form>
                  </td>
                </tr>
                {% empty %}
                <tr><td colspan="5" class="text-center text-muted">No hay materias disponibles.</td></tr>
                {% endfor %}
              </tbody>
            </table>
        </div>
      </div>

      <div class="p-3 shadow rounded bg-light">
        <h4 class="mb-3 text-primary">Carga Académica Actual</h4>
        <div class="table-responsive">
            <table class="table table-striped table-bordered align-middle">
              <thead class="bg-blue-600">
                <tr>
                  <th>Grupo</th>
                  <th>Materia</th>
                  <th>Horario</th>
                  <th>Estado</th>
                  <th>Acción</th>
                </tr>
              </thead>
              <tbody>
                {% for grupo in materias_asignadas %}
                <tr>
                  <td><strong>{{ grupo.clave_grupo }}</strong></td>
                  <td>{{ grupo.materia.nombre }}</td>
                  <td>
                      <small>
                      {% for h in grupo.horario_set.all %}
                         {{ h.get_dia_semana_display|slice:":3" }}: {{ h.hora_inicio|date:"H:i" }} - {{ h.hora_fin|date:"H:i" }}<br>
                      {% endfor %}
                      </small>
                  </td>
                  <td><span class="badge bg-primary">Asignada</span></td>
                  <td class="text-center">
                    
                    <button type="button" 
                            class="inline-flex items-center px-5 py-2.5 bg-red-600 text-white text-sm font-medium rounded-lg hover:bg-red-500 shadow-sm hover:shadow-md transition-all duration-200" 
                            data-bs-toggle="modal" 
                            data-bs-target="#modalDesasignar"
                            data-grupo-id="{{ grupo.id_grupo }}"
                            data-grupo-nombre="{{ grupo.materia.nombre }} ({{ grupo.clave_grupo }})">
                        Eliminar
                    </button>

                  </td>
                </tr>
                {% empty %}
                <tr><td colspan="5" class="text-center text-muted">Este docente no tiene carga asignada.</td></tr>
                {% endfor %}
              </tbody>
            </table>
        </div>
      </div>

<div class="mt-8 flex justify-center">
        <a href="{% url 'consultar_docente' %}"
            class="text-gray-500 hover:text-gray-800 font-medium text-sm flex items-center transition-colors">
            <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18">
                </path>
            </svg>
            Regresar al listado
        </a>
    </div>
</div>
    </div>
</div>

<div class="modal fade" id="modalDesasignar" tabindex="-1" aria-labelledby="modalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header bg-danger text-white">
        <h5 class="modal-title" id="modalLabel">Eliminar Asignación</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <p>¿Estás seguro de que deseas eliminar la materia <strong id="nombreMateriaModal"></strong> de la carga académica de este docente?</p>
        <p class="text-muted small">El grupo quedará vacante hasta que sea asignado nuevamente.</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="w-full sm:w-auto sm:ml-auto px-6 py-3 border border-charade-300 text-charade-700 font-medium rounded-lg hover:bg-white transition-colors text-center" data-bs-dismiss="modal">Cancelar</button>
        
        <form method="POST">
            {% csrf_token %}
            <input type="hidden" name="grupo_id" id="inputGrupoId">
            <input type="hidden" name="accion" value="desasignar">
            <button type="submit"  class="w-full sm:w-auto sm:ml-auto px-6 py-3 border border-charade-300 inline-flex items-center px-5 py-2.5 bg-red-600 text-white text-sm font-medium rounded-lg hover:bg-red-500 shadow-sm hover:shadow-md transition-all duration-200" >Sí, Eliminar</button>
        </form>
      </div>
    </div>
  </div>
</div>

{% endblock %}

{% block extra_js %}
    <script src="{% static 'js/scripts_docente.js' %}"></script>
{% endblock %}